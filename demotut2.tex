\documentclass{article}
\usepackage{multicol,fullpage,luacas,parskip,asypictureB}

\usepackage{pgfplots}
\usetikzlibrary{calc}

\begin{document}

\begin{CAS}
    vars('x')
    f = x^2+2*x-2
    g = x^2-1
    subs = {[x] = f}
    dh = substitute(subs,g)
\end{CAS}

\begin{CAS}
    h  = int(dh,x)+10
\end{CAS}

\[ \print{h} \] 

\begin{CAS}
    h = simplify(int(dh,x)+10)
\end{CAS}
\[ \print{h} \]

\begin{CAS}
    r = roots(dh) 
\end{CAS}

\[ \print{r[1]}, \quad \print{r[2]}, \quad \print{r[3]}, \quad \print{r[4]} \] 

\begin{CAS}
v = simplify(substitute({[x]=r[1]},h))
\end{CAS}
\[ \print{v} \]

\begin{CAS}
    vars('y')
    a = 1
    b = y+a
\end{CAS}
\[ \print{b} \] 

\directlua{
    vars('y')
    a = Integer(1)
    b = y+a
}
\[ \print{b} \] 


\directlua{
v = {}
for i=1,4 do 
    table.insert(v,simplify(
        substitute({[x]=r[i]},h)
        )
    )
end
}
\[ \print{v[1]}, \quad \print{v[2]}, \quad \print{v[3]}, \quad \print{v[4]} \] 

\begin{tikzpicture}[scale=0.9]
    \begin{axis}[legend pos = north west]
    \addplot [domain=-3.5:1.5,samples=100]
        {\fetch{h}};
    \addlegendentry{$f$};
    \addplot[densely dashed] 
        [domain=-3.25:1.25,samples=100]
        {\fetch{dh}};
    \addlegendentry{$df/dx$};
    \addplot[gray,dashed,thick]
        [domain=-3.5:1.5] {0};
    \end{axis}
\end{tikzpicture}

\store{h}
\store{dh}

\store{r[1]}[rootone]

\store{r}
\store{v}

\def\ralt{{ \fetch{r[1]}, \fetch{r[2]}, \fetch{r[3]}, \fetch{r[4]} }}

\begin{tikzpicture}
\begin{axis}[legend pos = north west]
    \addplot 
    [domain=-3.5:1.5,samples=100] {\h};
    \addlegendentry{$f$};
    \addplot[densely dashed] 
    [domain=-3.25:1.25,samples=100] {\dh};
    \addlegendentry{$df/dx$};
    \addplot[gray,dashed,thick]
    [domain=-3.5:1.5] {0};
    \coordinate (O) at (axis cs:0,0);
    \coordinate (X) at (axis cs:1,0);
    \coordinate (Y) at (axis cs:0,1);
\end{axis}
\begin{scope}[x={($(X)-(O)$)},
     y={($(Y)-(O)$)},
     shift={(O)}]
    \foreach \k in {0,1,2,3}{
    \pgfmathsetmacro\a{\r[\k]}
    \pgfmathsetmacro\b{\v[\k]}
    \draw[fill=purple,purple]
    (\a,0) circle (1.5pt)
    (\a,\b) circle (1.5pt)
    (\a,0) edge[dashed] (\a,\b);
    }
\end{scope}
\end{tikzpicture}

\newpage

Consider the function $f(x)$ defined by:
    \begin{CAS}
        vars('x')
        f = x^2+2*x-2
        g = x^2-1
        subs = {[x] = f}
        dh = expand(substitute(subs,g))
        h = simplify(int(dh,x)+10)
    \end{CAS}
    $\displaystyle f(x) = \print{h}$.
\begin{multicols}{2}
    Note that: 
    \[ f'(x) = \print{dh}.\] 
    The roots to $f'(x)=0$ equation are:
    \begin{CAS}
        r = roots(dh)
    \end{CAS}
    \[ \print{r[1]}, \quad \print{r[2]}, \quad \print{r[3]}, \quad \print{r[4]}.\] 
    Recall: $f'(x_0)$ measures the slope of the tangent line to $y=f(x)$ at $x=x_0$. The values $r$ where $f'(r)=0$ correspond to places where the slope of the tangent line to $y=f(x)$ is horizontal (see the illustration). This gives us a method for identifying locations where the graph $y=f(x)$ attains a peak (local maximum) or a valley (local minimum). 
    \columnbreak 
    \store{h}\store{dh}
    \begin{tikzpicture}[scale=0.95]
    \begin{axis}[legend pos = north west]
        \addplot 
        [domain=-3.5:1.5,samples=100] {\h};
        \addlegendentry{$f$};
        \addplot[densely dashed] 
        [domain=-3.25:1.25,samples=100] {\dh};
        \addlegendentry{$df/dx$};
        \addplot[gray,dashed,thick]
        [domain=-3.5:1.5] {0};
        \luaexec{for i=1,4 do 
        tex.print("\\draw[fill=purple,purple]",
            "(axis cs:{", tostring(r[i]) ,"},0) circle (1.5pt)",
            "(axis cs:{", tostring(r[i]) ,"},{", tostring(v[i]), "}) circle (1.5pt)",
            "(axis cs:{", tostring(r[i]) ,"},{", tostring(v[i]), "}) edge[dashed] (axis cs:{", tostring(r[i]) ,"},0);")
        end}
    \end{axis}
    \end{tikzpicture}
\end{multicols}

\end{document}