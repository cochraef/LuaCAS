\documentclass{article}
\usepackage{luacas}

\usepackage{verbatim}
\usepackage{parskip}
\usepackage{comment}
\usepackage{forest}
%\usepackage{tikz-qtree}
\usepackage{pgfplots}


\begin{document}

Hi!
\CAS{
    vars("x","y")
    g = DD(x*cos(x),x)
}
Consider the expression $\print*{g}$.

\parseforest{g}
\bracketset{action character = @}
\begin{forest}
    for tree={draw,font=\ttfamily}
    @\forestresult
\end{forest}

Here is the evaluated tree for $\print{g}$:

\parseforest*{g}
\begin{forest}
    @\forestresult
\end{forest}

\luaexec{
    h = g:autosimplify()
}

\luaexec{
    tex.print("\\def\\a{",tostring(h),"}")
}
\begin{tikzpicture}
    \begin{axis}
        \addplot [domain = 0:2] {\a};
    \end{axis}
\end{tikzpicture}

\luaexec{
    vars("x","f")
    a = f(x*x)
}
$\print{DD(a,x)}$

\CAS{
    a = x^4 -1
    a = a:autosimplify()
    a = a:topolynomial()
    b = x^2+1
    b = b:topolynomial()
    c = a \% b
}
$\print{c}$

\CAS{
    vars("x","y")
}


\end{document}

