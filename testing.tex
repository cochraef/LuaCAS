\documentclass{article}
\usepackage{luacas}

\usepackage{verbatim}
\usepackage{parskip}
\usepackage{comment}
\usepackage{forest}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

\usepackage{asypictureB}

\begin{document}

Hi!
\begin{CAS}
    vars("x","y")
    g = DD(x*cos(x),x)
\end{CAS}
Consider the expression $\print*{g}$.

\parseforest{g}
\bracketset{action character = @}
\begin{forest}
    for tree={draw,font=\ttfamily}
    @\forestresult
\end{forest}

Here is the evaluated tree for $\print{g}$:

\parseforest*{g}
\begin{forest}
    @\forestresult
\end{forest}

\luaexec{
    h = g:autosimplify()
}

\luaexec{
    tex.print("\\def\\a{",tostring(h),"}")
}
$\a$
\begin{tikzpicture}
    \begin{axis}
        \addplot [domain = 0:2] {\a};
    \end{axis}
\end{tikzpicture}

%this is bad ass

\begin{asypicture}{width=5cm}
    import graph;
    size(7cm,0);
    
    real f(real x){
        return @a;
        }
    path q = graph(f,0,2,operator..);
    draw(q,blue);
    
    xaxis("$x$",0,3,Arrow);
    yaxis("$y$",0,3,Arrow);
\end{asypicture}

\luaexec{
    vars("x","f")
    a = f(x*x)
}
$\print{DD(a,x)}$

\begin{CAS}
    a = x^4 -1
    a = a:autosimplify()
    a = a:topolynomial()
    b = x^2+1
    b = b:topolynomial()
    c = a \% b
\end{CAS}
$\print{c}$

\hrulefill

\begin{CAS}
    a = x*y
    b = x*y
    c = a-b
\end{CAS}
$\print*{c:autosimplify()}$

$\print*{c:simplifysum()}$

$\print*{c:simplifydifference()}$

$\print*{c:simplifyproduct()}$


\end{document}

